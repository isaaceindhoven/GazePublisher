#!/usr/bin/env bash

DOCKSAL_FIN_EXIST=$(fin 2>&1 > /dev/null)

if [[ $DOCKSAL_FIN_EXIST -eq 0 && -e "$PWD/.docksal/commands/phpstan" ]]; then
  PHPSTAN_CMD="$PWD/.docksal/commands/phpstan"
  echo "Using PHPStan in docksal"
elif [[ -e "$PWD/vendor/bin/phpstan" ]]; then
  PHPSTAN_CMD="$PWD/vendor/bin/phpstan"
  echo "Using local PHPStan"
else
  echo "Cannot find a PHPStan installation."
  exit 1
fi

$PHPSTAN_CMD
RETVAL=$?

if [[ -$RETVAL -ne 0 ]]; then
  echo "PHPStan errors detected!"
  echo "$OUTPUT"
  exit $RETVAL
fi
